<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Climate Label Experiment</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 0; padding: 0; }
    .hidden { display: none; }
    .button { padding: 10px 20px; margin: 10px; cursor: pointer; }
    /* Additional styling to mimic the original look */
  </style>
</head>
<body>
  <!-- Consent Screen -->
  <div id="consent">
    <h2>Consent</h2>
    <p>Please read the consent form and click “I Agree” to proceed.</p>
    <button class="button" id="consentBtn">I Agree</button>
  </div>

  <!-- Background Screen -->
  <div id="background" class="hidden">
    <h2>Background</h2>
    <p>Some background information goes here.</p>
    <button class="button" id="backgroundBtn">Next</button>
  </div>

  <!-- Instructions Screen -->
  <div id="instructions" class="hidden">
    <h2>Instructions</h2>
    <p>In each trial, an image will appear for 2000 ms. Then enter the price and select the climate label.</p>
    <button class="button" id="startBtn">Start Experiment</button>
  </div>

  <!-- Trial Screen -->
  <div id="trial" class="hidden">
    <img id="trialImage" src="" alt="Trial Image" style="max-width:80%; height:auto; margin-top: 50px;"/><br>
    <div id="response" class="hidden">
      <input type="number" id="priceInput" placeholder="Enter price" /><br>
      <!-- Climate label buttons (adjust labels as needed) -->
      <button class="button" data-label="Option1">Option 1</button>
      <button class="button" data-label="Option2">Option 2</button><br>
      <button class="button" id="submitTrial">Submit</button>
    </div>
  </div>

  <!-- Thank You Screen -->
  <div id="thankyou" class="hidden">
    <h2>Thank you!</h2>
    <p>You have completed the experiment.</p>
  </div>

  <script>
    // Trials from CSV converted into an array
    const trials = [
      { itemID: "mælk", labelPosition: "U", labelType: "A", imageFile: "images/mælk_U_A.png" },
      { itemID: "mælk", labelPosition: "D", labelType: "A", imageFile: "images/mælk_D_A.png" },
      { itemID: "kylling", labelPosition: "U", labelType: "E", imageFile: "images/kylling_U_E.png" },
      { itemID: "kylling", labelPosition: "D", labelType: "E", imageFile: "images/kylling_D_E.png" }
    ];

    let currentTrial = 0;
    let trialOrder = [];

    // Function to shuffle the trials array
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // Helper to show a section
    function showSection(id) {
      document.querySelectorAll("div").forEach(div => div.classList.add("hidden"));
      document.getElementById(id).classList.remove("hidden");
    }

    // Screen navigation
    document.getElementById("consentBtn").addEventListener("click", () => {
      showSection("background");
    });
    document.getElementById("backgroundBtn").addEventListener("click", () => {
      showSection("instructions");
    });
    document.getElementById("startBtn").addEventListener("click", () => {
      trialOrder = shuffle(trials.slice());
      currentTrial = 0;
      runTrial();
    });

    // Run a single trial
    function runTrial() {
      if (currentTrial >= trialOrder.length) {
        showSection("thankyou");
        return;
      }
      const trialData = trialOrder[currentTrial];
      showSection("trial");
      document.getElementById("response").classList.add("hidden");
      document.getElementById("trialImage").src = trialData.imageFile;

      // After 2000 ms, show the response panel
      setTimeout(() => {
        document.getElementById("response").classList.remove("hidden");
      }, 2000);
    }

    // Handle trial submission
    document.getElementById("submitTrial").addEventListener("click", () => {
      const price = document.getElementById("priceInput").value;
      const selectedButton = document.querySelector('button[data-label].selected');
      const climateLabel = selectedButton ? selectedButton.getAttribute("data-label") : "";
      
      // Log or save the trial data (implement saving as needed)
      console.log("Trial", currentTrial, trialOrder[currentTrial], "Price:", price, "Climate Label:", climateLabel);
      
      // Reset inputs
      document.getElementById("priceInput").value = "";
      document.querySelectorAll('button[data-label]').forEach(btn => btn.classList.remove("selected"));
      
      currentTrial++;
      runTrial();
    });

    // Add selection behavior for climate label buttons
    document.querySelectorAll('button[data-label]').forEach(btn => {
      btn.addEventListener("click", function() {
        document.querySelectorAll('button[data-label]').forEach(b => b.classList.remove("selected"));
        this.classList.add("selected");
      });
    });
  </script>
</body>
</html>
